<!DOCTYPE HTML>
<!--
	Phantom by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<?php
include_once './assets/php/tablemaker.php';

	$f = './data/full_archive.csv';
	$games = new TableMaker($f);
	$f = './data/full_rankings.csv';
	$rankings = new TableMaker($f);

	
	$top = [];
	$t = 0;
	$cs_totals = [];
	while($t < 50){
		$top[$rankings->data[$t]['corporation']] = $rankings->data[$t];
		$t++;
	}
	$corpall = [];
	foreach( $games->data as $g ){
		if ( $g['players']>0 ){
			// GC: Counts game types for each Corp
			$type = $g['players'] . "v" . $g['players'];
			$team1 = $g['team1'];
			$team2 = $g['team2'];
			if (isset($top[$team1])){
				$top[$team1][$type] += 1;
			}else{
				$corpall[$team1] +=1;
			}
			if (isset($top[$team2])){
				$top[$team2][$type] += 1;
			}else{
				$corpall[$team2] +=1;
			}
			$max = max( [$g['score1'],$g['score2']] );
			$diff = abs( $g['score1'] - $g['score2'] );
			// GS: Total Games
			$cs_totals[$type]['total'] += 1;
			// GS: Average Relics for Winner
			$cs_totals[$type]['relics'] += $max;
			// GS: Average Points Difference
			$cs_totals[$type]['diff'] += $diff;
			// GS: Highest Relics
			if ($max > $cs_totals[$type]['high']) {
				$cs_totals[$type]['high'] = $max;
				$cs_totals[$type]['highdate'] = $g['date'];
			}
			// GS: Percentage of Close* Games
			$d = round(($diff*100) / $max,2);
			if ( $d <= 30) {
				$cs_totals[$type]['close'] += $d;
				$cs_totals[$type]['closecount'] += 1;
			}
		}
	}

	
/*
	Corporation statistics
*/
	$t = 0;
	$cs_top20 = 0;
	$cs_top50 = 0;
	$cs_all = 0;
	$cs_most = 0;
	/*
		Count totals for Top20 and 50
	*/
	foreach($top as $v){
		$total = $v['5v5'] + $v['15v15'] + $v['10v10'];

		if ($t < 20){
			$cs_top20 += $total;
		}else{
			$cs_top50 += $total;
		}
		if ($total > $cs_most) { $cs_most = $total; }
		$t++;
	}
	/*
		Count totals for rest
	*/
	foreach($corpall as $total){
		$cs_all += $total;
		if ($total > $cs_most) { $cs_most = $total; }
	}
	$stats =[];
	$stats['cs']['top20'] = round(($cs_top20 / 20),1);
	$stats['cs']['top50'] = round((($cs_top20+$cs_top50) / 50),1);
	$stats['cs']['all'] = round((($cs_top20+$cs_top50+$cs_all) / (50+count($corpall))),1);
	$stats['cs']['most'] = $cs_most;
	foreach($cs_totals as $k => $v){
		$stats['gs']['total'][$k] = $v['total'];
		$stats['gs']['relics'][$k] = round($v['relics'] / $v['total']);
		$stats['gs']['diff'][$k] = round($v['diff'] / $v['total']);
		$stats['gs']['high'][$k] = $v['high'] . '<br>' . $v['highdate'];
		$stats['gs']['close'][$k] = round($v['close']/ $v['closecount'],1) . "%";
	}
	echo var_dump($stats['gs']);

	function getHTMLgs($gs,$name){
		$type = [ '15v15', '10v10', '5v5' ];
		$h = '';
		foreach($type as $t ){
			$h .= '<td>' . $gs[$t] . '</td>';
		}
		return '<tr><td><b>'.$name.'</b></td>'.$h.'</tr>';
	}
/*

*/
	
?>
<html>
	<head>
		<title>WS Community Leaderboard</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">
		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="inner">

							<!-- Logo -->
								<a href="index.html" class="logo">
									<span class="symbol"><img src="images/logo.svg" alt="logo" /></span><span class="title">Home</span>
								</a>

							<!-- Nav -->
								<nav>
									<ul>
										<li><a href="#menu">Menu</a></li>
									</ul>
								</nav>

						</div>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<h2>Menu</h2>
						<ul>
							<li><a href="index.html">Home</a></li>
							<li><a href="full-rankings.html">Full Rankings</a></li>
							<li><a href="game_archive.html">Game Archives</a></li>
							<li><a href="statistics.html">Statistics</a></li>
							<li><a href="interviews.html">Interviews</a></li>
							<li><a href="support.html">Support</a></li>
							<li><a href="future-features.html">Future Features</a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">
						<div class="inner">
							<header>
								<span class="image main"><img src="images/hadesstar-playercroporationship-by-gabrielbjorkstiernstrom.jpg" alt="header_artwork_corporationship" />
									<div  style="text-align: right"><sup>Artwork by <a href="https://gabrielbjorkstiernstrom.artstation.com/" target="_blank">Gabriel Bjorkstiernstrom</a></sup></div>
								</span>
								<h1>Statistics</h1>
								<p>My hope is to grow this page more in the near future, with statistics for every corporation here, such as total wins and losses, high scores per bracket, and more! In the meantime, here are some total game database statistics for those who enjoy a little data visualisation.</p>
							</header>
							<section>
								<h2>Global Statistics</h2>
								<under>Updated for v8.3</under>
								<br><br>
								<span class="table-wrapper">
									<table style="max-width: 800px">
										<thead>
											<tr>
												<th width=50%><h3 style="margin: 0">Corporation Statistics</h3></th>
												<th>Top 20</th>
												<th>Top 50</th>
												<th>All</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td><b>Average Games per Corporation</b></td>
												<td><?=$stats['cs']['top20']?></td>
												<td><?=$stats['cs']['top50']?></td>
												<td><?=$stats['cs']['all']?></td>
											</tr>
											<tr>
												<td><b>Most Games Submitted</b></td>
												<td></td>
												<td></td>
												<td><?=$stats['cs']['most']?></td>
											</tr>
										</tbody>
									</table>
								</span>
								<h3>Ratings of Top 20</h3>
								<div class="row gtr-uniform">
									<div class="col-12"><span class="image fit" style="max-width: 800px"><img src="images/top20_rating.svg" alt="top20_rating"/></span></div>
								</div>
								<under>Faded columns indicate non-qualifying teams - i.e. less than 3 recorded games in the past 6 months.</under>
								<br><br>
								</span>
								<span>
								<h3>Size Breakdown of Top 20</h3>
								<div class="row gtr-uniform">
									<div class="col-12"><span class="image fit" style="max-width: 800px"><img src="images/top20_percent.svg" alt="top20_percent"/></span></div>
								</div>
								<br>
								<span class="table-wrapper">
									<table style="max-width: 800px">
										<thead>
											<tr>
												<th width=50%><h3 style="margin: 0">Game Statistics</h3></th>
												<th>15 v 15</th>
												<th>10 v 10</th>
												<th>5 v 5</th>
											</tr>
										</thead>
										<tbody>
											<?=getHTMLgs($stats['gs']['total'],"Total Games")?>
											<?=getHTMLgs($stats['gs']['relics'],"Average Relics for Winner")?>
											<?=getHTMLgs($stats['gs']['diff'],"Average Points Difference")?>
											<?=getHTMLgs($stats['gs']['close'],"Percentage of Close* Games")?>
											<?=getHTMLgs($stats['gs']['high'],"Highest Relics")?>
										</tbody>
									</table>
									<under>* Close is defined as: a score difference of < 30% of the winners relic count.</under>
									<br><br>
								<span>
								<h3>All Submitted Game Sizes</h3>
								<div class="row gtr-uniform">
									<div class="col-12"><span class="image fit" style="max-width: 800px"><img src="images/all_size_percent.svg" alt="all_size_percent"/></span></div>
								</div>
								<br>
								</span>
								<span>
								<h3>Day of Week for Match Start</h3>
								<div class="row gtr-uniform">
									<div class="col-12"><span class="image fit" style="max-width: 800px"><img src="images/day_of_week.svg" alt="day_of_week"/></span></div>
								</div>
								<br>
								</span>
								<span>
								<h3>Total Corporations</h3>
								<p>The original leaderboard, which existed as an ethereally-sourced list in HSO #white-stars, contained only 25 coporations. V5.0, posted in Novemember 2020, was the last of its kind. My early records of v6 were not great, however I began in January 2021 with around 100 corporations, and by v6.9 in August 2021 this had grown to just over 300. As of v7.0, records are far more reliable, and here below is the growth in the total number of corporations since. Also on file are the scores for each corporation at the conclusion of each cycle, however I am yet to find a convenient way to make this accessible.</p>
								<div class="row gtr-uniform">
									<div class="col-12"><span class="image fit" style="max-width: 800px"><img src="images/total_corporations.svg" alt="total_corporations"/></span></div>
								</div>
								<br>
								</span>
								<p>Have any other stats you'd like to see here? Let us know!</p>
							</section>
						</div>
					</div>

				<!-- Footer -->
					<footer id="footer">
						<div class="inner">
							<section>
								<h2>Get In Touch</h2>
								<ul class="icons">
									<li><a href="https://discord.gg/p588eHaFqh" class="icon brands style2 fa-discord"><span class="label">Discord</span></a></li>
								</ul>
							</section>
							<ul class="copyright">
								<li>Created by Timmeh, backend magic by NandGates</li>
								<li>Phantom site template by <a href="http://html5up.net" target="_blank">HTML5 UP</a></li>
								<li>Banner artwork by <a href="https://gabrielbjorkstiernstrom.artstation.com/" target="_blank">Gabriel Bjorkstiernstrom</a></li>
							</ul>
						</div>
					</footer>
			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>